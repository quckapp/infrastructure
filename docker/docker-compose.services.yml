# =============================================================================
# QUCKAPP - APPLICATION SERVICES DOCKER COMPOSE
# =============================================================================
# All application services for local development
# Usage: docker compose -f docker-compose.infra.yml -f docker-compose.services.yml up
# =============================================================================

services:
  # ===========================================================================
  # API GATEWAY & AUTH
  # ===========================================================================

  # Backend Gateway (NestJS) - Main API entry point
  backend-gateway:
    build:
      context: ../../services/nestjs/backend-gateway
      dockerfile: ../../infrastructure/docker/dockerfiles/nestjs/Dockerfile
    container_name: quckapp-backend-gateway
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 3000
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      USER_SERVICE_URL: http://user-service:3002
      WORKSPACE_SERVICE_URL: http://workspace-service:3003
      CHANNEL_SERVICE_URL: http://channel-service:3004
      MESSAGE_SERVICE_URL: http://message-service:3005
      FILE_SERVICE_URL: http://file-service:3006
      SEARCH_SERVICE_URL: http://search-service:3007
      NOTIFICATION_SERVICE_URL: http://notification-service:3008
      # Elixir Services
      PRESENCE_SERVICE_URL: http://presence-service:4000
      CALL_SERVICE_URL: http://call-service:4002
      REALTIME_SERVICE_URL: http://realtime-service:4003
      NOTIFICATION_ORCHESTRATOR_URL: http://notification-orchestrator:4004
      HUDDLE_SERVICE_URL: http://huddle-service:4005
      MESSAGE_SERVICE_ELIXIR_URL: http://message-service-elixir:4006
      EVENT_BROADCAST_SERVICE_URL: http://event-broadcast-service:4007
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "${GATEWAY_PORT:-3000}:3000"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Auth Service (NestJS) - Authentication & Authorization (Legacy)
  auth-service-nestjs:
    build:
      context: ../../services/nestjs/auth-service
      dockerfile: ../../infrastructure/docker/dockerfiles/nestjs/Dockerfile
    container_name: quckapp-auth-service-nestjs
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 3001
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      JWT_EXPIRATION: 3600
      REFRESH_TOKEN_EXPIRATION: 604800
      OAUTH_GOOGLE_CLIENT_ID: ${OAUTH_GOOGLE_CLIENT_ID:-}
      OAUTH_GOOGLE_CLIENT_SECRET: ${OAUTH_GOOGLE_CLIENT_SECRET:-}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3001:3001"
    depends_on:
      - postgres
      - redis
    networks:
      - quckapp-network

  # Auth Service (Spring Boot) - Primary Authentication Service
  auth-service:
    build:
      context: ../../services/auth-service
      dockerfile: Dockerfile
    container_name: quckapp-auth-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: docker
      SERVER_PORT: 8081
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: redis_secret
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      JWT_EXPIRATION: 3600
      REFRESH_TOKEN_EXPIRATION: 604800
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "8081:8081"
    depends_on:
      - postgres
      - redis
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # USER & WORKSPACE MANAGEMENT
  # ===========================================================================

  # User Service (NestJS) - User profiles and management
  user-service:
    build:
      context: ../../services/nestjs/user-service
      dockerfile: ../../infrastructure/docker/dockerfiles/nestjs/Dockerfile
    container_name: quckapp-user-service
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 3002
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      MINIO_ENDPOINT: minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3002:3002"
    depends_on:
      - postgres
      - redis
      - kafka
      - minio
    networks:
      - quckapp-network

  # Workspace Service (Spring Boot) - Workspace management
  workspace-service:
    build:
      context: ../../services/spring-boot/workspace-service
      dockerfile: ../../infrastructure/docker/dockerfiles/springboot/Dockerfile
    container_name: quckapp-workspace-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: 3003
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: redis_secret
      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3003:3003"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

  # ===========================================================================
  # MESSAGING & CHANNELS
  # ===========================================================================

  # Channel Service (Spring Boot) - Channel management
  channel-service:
    build:
      context: ../../services/spring-boot/channel-service
      dockerfile: ../../infrastructure/docker/dockerfiles/springboot/Dockerfile
    container_name: quckapp-channel-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: 3004
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: redis_secret
      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3004:3004"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

  # Message Service (Go) - High-performance message handling
  message-service:
    build:
      context: ../../services/go/message-service
      dockerfile: ../../infrastructure/docker/dockerfiles/go/Dockerfile
    container_name: quckapp-message-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 3005
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      ELASTICSEARCH_URL: http://elasticsearch:9200
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3005:3005"
    depends_on:
      - postgres
      - redis
      - kafka
      - elasticsearch
    networks:
      - quckapp-network

  # Thread Service (Go) - Thread management
  thread-service:
    build:
      context: ../../services/go/thread-service
      dockerfile: ../../infrastructure/docker/dockerfiles/go/Dockerfile
    container_name: quckapp-thread-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 3006
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3006:3006"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

  # ===========================================================================
  # FILE & MEDIA SERVICES
  # ===========================================================================

  # File Service (Go) - File upload and management
  file-service:
    build:
      context: ../../services/go/file-service
      dockerfile: ../../infrastructure/docker/dockerfiles/go/Dockerfile
    container_name: quckapp-file-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 3007
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      MINIO_ENDPOINT: minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      MINIO_BUCKET: quckapp-files
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3007:3007"
    depends_on:
      - postgres
      - redis
      - kafka
      - minio
    networks:
      - quckapp-network

  # Media Service (Go) - Media processing
  media-service:
    build:
      context: ../../services/go/media-service
      dockerfile: ../../infrastructure/docker/dockerfiles/go/Dockerfile
    container_name: quckapp-media-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 3008
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      MINIO_ENDPOINT: minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3008:3008"
    depends_on:
      - postgres
      - redis
      - kafka
      - minio
    networks:
      - quckapp-network

  # ===========================================================================
  # SEARCH & NOTIFICATIONS
  # ===========================================================================

  # Search Service (Go) - Full-text search
  search-service:
    build:
      context: ../../services/go/search-service
      dockerfile: ../../infrastructure/docker/dockerfiles/go/Dockerfile
    container_name: quckapp-search-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 3009
      ELASTICSEARCH_URL: http://elasticsearch:9200
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3009:3009"
    depends_on:
      - elasticsearch
      - redis
      - kafka
    networks:
      - quckapp-network

  # Notification Service (NestJS) - Push notifications
  notification-service:
    build:
      context: ../../services/nestjs/notification-service
      dockerfile: ../../infrastructure/docker/dockerfiles/nestjs/Dockerfile
    container_name: quckapp-notification-service
    restart: unless-stopped
    environment:
      NODE_ENV: development
      PORT: 3010
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      FCM_PROJECT_ID: ${FCM_PROJECT_ID:-}
      FCM_PRIVATE_KEY: ${FCM_PRIVATE_KEY:-}
      FCM_CLIENT_EMAIL: ${FCM_CLIENT_EMAIL:-}
      APNS_KEY_ID: ${APNS_KEY_ID:-}
      APNS_TEAM_ID: ${APNS_TEAM_ID:-}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3010:3010"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

  # ===========================================================================
  # REALTIME & PRESENCE (Elixir)
  # ===========================================================================

  # Presence Service (Elixir) - User presence tracking
  presence-service:
    build:
      context: ../../services/presence-service
      dockerfile: Dockerfile
      args:
        APP_NAME: presence_service
    container_name: quckapp-presence-service
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4000
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/presence_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4000:4000"
      - "4369:4369"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Realtime Service (Elixir/Phoenix) - WebSocket connections
  realtime-service:
    build:
      context: ../../services/realtime-service
      dockerfile: Dockerfile
      args:
        APP_NAME: realtime_service
    container_name: quckapp-realtime-service
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4003
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/realtime_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      PHX_HOST: localhost
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4003:4003"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4003/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # VOICE & VIDEO (Elixir)
  # ===========================================================================

  # Call Service (Elixir) - Voice/Video calls
  call-service:
    build:
      context: ../../services/call-service
      dockerfile: Dockerfile
      args:
        APP_NAME: call_service
    container_name: quckapp-call-service
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4002
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/call_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4002:4002"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4002/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Huddle Service (Elixir) - Quick audio rooms
  huddle-service:
    build:
      context: ../../services/huddle-service
      dockerfile: Dockerfile
      args:
        APP_NAME: huddle_service
    container_name: quckapp-huddle-service
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4005
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/huddle_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4005:4005"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4005/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # MESSAGING & NOTIFICATIONS (Elixir)
  # ===========================================================================

  # Message Service (Elixir) - Real-time messaging
  message-service-elixir:
    build:
      context: ../../services/message-service
      dockerfile: Dockerfile
      args:
        APP_NAME: message_service
    container_name: quckapp-message-service-elixir
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4006
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/message_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4006:4006"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4006/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Notification Orchestrator (Elixir) - Push notification management
  notification-orchestrator:
    build:
      context: ../../services/notification-orchestrator
      dockerfile: Dockerfile
      args:
        APP_NAME: notification_orchestrator
    container_name: quckapp-notification-orchestrator
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4004
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/notification_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      FCM_PROJECT_ID: ${FCM_PROJECT_ID:-}
      FCM_PRIVATE_KEY: ${FCM_PRIVATE_KEY:-}
      FCM_CLIENT_EMAIL: ${FCM_CLIENT_EMAIL:-}
      APNS_KEY_ID: ${APNS_KEY_ID:-}
      APNS_TEAM_ID: ${APNS_TEAM_ID:-}
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4004:4004"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4004/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Event Broadcast Service (Elixir) - Event distribution
  event-broadcast-service:
    build:
      context: ../../services/event-broadcast-service
      dockerfile: Dockerfile
      args:
        APP_NAME: event_broadcast_service
    container_name: quckapp-event-broadcast-service
    restart: unless-stopped
    environment:
      MIX_ENV: prod
      PORT: 4007
      MONGODB_URL: mongodb://admin:admin_secret@mongodb:27017/event_db?authSource=admin
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:-dev_secret_key_base_min_64_chars_long_for_phoenix_app_1234567890}
      JWT_SECRET: ${JWT_SECRET:-dev_jwt_secret_change_in_production}
      AUTH_SERVICE_URL: http://auth-service:8081
      RELEASE_COOKIE: ${ERLANG_COOKIE:-quckapp_dev_cookie}
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "4007:4007"
    depends_on:
      - mongodb
      - redis
      - kafka
    networks:
      - quckapp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4007/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ===========================================================================
  # ANALYTICS & ML (Python)
  # ===========================================================================

  # Analytics Service (Python/FastAPI) - Usage analytics
  analytics-service:
    build:
      context: ../../services/python/analytics-service
      dockerfile: ../../infrastructure/docker/dockerfiles/python/Dockerfile
    container_name: quckapp-analytics-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 8000
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      CLICKHOUSE_HOST: clickhouse
      CLICKHOUSE_PORT: 9000
      CLICKHOUSE_USER: quckapp
      CLICKHOUSE_PASSWORD: clickhouse_secret
      CLICKHOUSE_DB: quckapp_analytics
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "8000:8000"
    depends_on:
      - postgres
      - clickhouse
      - redis
      - kafka
    networks:
      - quckapp-network

  # ML Service (Python/FastAPI) - Machine learning
  ml-service:
    build:
      context: ../../services/python/ml-service
      dockerfile: ../../infrastructure/docker/dockerfiles/python/Dockerfile
    container_name: quckapp-ml-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 8001
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      MODEL_PATH: /app/models
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "8001:8001"
    volumes:
      - ml_models:/app/models
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

  # Moderation Service (Python/FastAPI) - Content moderation
  moderation-service:
    build:
      context: ../../services/python/moderation-service
      dockerfile: ../../infrastructure/docker/dockerfiles/python/Dockerfile
    container_name: quckapp-moderation-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 8002
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      ML_SERVICE_URL: http://ml-service:8001
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "8002:8002"
    depends_on:
      - postgres
      - redis
      - kafka
      - ml-service
    networks:
      - quckapp-network

  # Sentiment Service (Python/FastAPI) - Sentiment analysis
  sentiment-service:
    build:
      context: ../../services/python/sentiment-service
      dockerfile: ../../infrastructure/docker/dockerfiles/python/Dockerfile
    container_name: quckapp-sentiment-service
    restart: unless-stopped
    environment:
      ENV: development
      PORT: 8003
      DATABASE_URL: postgresql://quckapp:quckapp_secret@postgres:5432/quckapp
      REDIS_URL: redis://:redis_secret@redis:6379
      KAFKA_BROKERS: kafka:9092
      ML_SERVICE_URL: http://ml-service:8001
      JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "8003:8003"
    depends_on:
      - postgres
      - redis
      - kafka
      - ml-service
    networks:
      - quckapp-network

  # ===========================================================================
  # ADMIN & SECURITY (Spring Boot)
  # ===========================================================================

  # Permission Service (Spring Boot) - RBAC permissions
  permission-service:
    build:
      context: ../../services/spring-boot/permission-service
      dockerfile: ../../infrastructure/docker/dockerfiles/springboot/Dockerfile
    container_name: quckapp-permission-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: 3011
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: redis_secret
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3011:3011"
    depends_on:
      - postgres
      - redis
    networks:
      - quckapp-network

  # Audit Service (Spring Boot) - Audit logging
  audit-service:
    build:
      context: ../../services/spring-boot/audit-service
      dockerfile: ../../infrastructure/docker/dockerfiles/springboot/Dockerfile
    container_name: quckapp-audit-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: 3012
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_DATA_MONGODB_URI: mongodb://admin:admin_secret@mongodb:27017/quckapp?authSource=admin
      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3012:3012"
    depends_on:
      - postgres
      - mongodb
      - kafka
    networks:
      - quckapp-network

  # Admin Service (Spring Boot) - Admin dashboard API
  admin-service:
    build:
      context: ../../services/spring-boot/admin-service
      dockerfile: ../../infrastructure/docker/dockerfiles/springboot/Dockerfile
    container_name: quckapp-admin-service
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: 3013
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/quckapp
      SPRING_DATASOURCE_USERNAME: quckapp
      SPRING_DATASOURCE_PASSWORD: quckapp_secret
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: redis_secret
      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
      OTEL_EXPORTER_JAEGER_ENDPOINT: http://jaeger:14268/api/traces
    ports:
      - "3013:3013"
    depends_on:
      - postgres
      - redis
      - kafka
    networks:
      - quckapp-network

# =============================================================================
# VOLUMES
# =============================================================================
volumes:
  ml_models:
    driver: local

# =============================================================================
# NETWORKS
# =============================================================================
networks:
  quckapp-network:
    external: true
    name: quckapp-network
