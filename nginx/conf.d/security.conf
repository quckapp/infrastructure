# =============================================================================
# QuckApp Security Configuration
# =============================================================================
# Rate limiting zones, security headers, and CORS configuration.
# =============================================================================

# ============================================
# Rate Limiting Zones
# ============================================
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/s;
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=upload_limit:10m rate=10r/s;
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

# ============================================
# WebSocket Connection Upgrade Map
# ============================================
# Properly handles the Connection header for WebSocket upgrades.
# If the client sends Upgrade header, Connection is set to "upgrade";
# otherwise it's set to close (for keepalive proxying).
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

# ============================================
# Proxy Cache Configuration
# ============================================
proxy_cache_path /var/cache/nginx/proxy_cache
    levels=1:2
    keys_zone=static_cache:10m
    max_size=1g
    inactive=60m
    use_temp_path=off;
